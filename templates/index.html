<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Calendario de Proyectos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<h1>ğŸ“… Proyectos</h1>

<!-- ================= CALENDARIO ================= -->
<h2 class="section-title">ğŸ“† Calendario</h2>
<div class="calendar-wrapper">
    <div class="calendar-nav">
        <button onclick="prevMonth()">â¬…ï¸</button>
        <span id="calendar-title"></span>
        <button onclick="nextMonth()">â¡ï¸</button>
    </div>
    <div class="calendar-container">
        <div id="calendar1" class="calendar"></div>
        <div id="calendar2" class="calendar"></div>
    </div>
</div>

<script>
    const proyectos = {{ proyectos | tojson }};
</script>
<script src="{{ url_for('static', filename='calendar.js') }}"></script>

<hr>

<!-- ================= CREAR PROYECTO ================= -->
<h2>â• Nuevo proyecto</h2>

<form method="POST" action="/crear_proyecto">
    <input type="text" name="nombre" placeholder="Nombre del proyecto" required>

    <label>Inicio</label>
    <input type="date" name="inicio" required>

    <label>Fin</label>
    <input type="date" name="fin" required>

    <input type="color" name="color" value="#4D96FF">

    <button type="submit">Crear proyecto</button>
</form>

<hr>

<!-- ================= LISTA DE PROYECTOS ================= -->
<h2>ğŸ“‹ Proyectos y tareas</h2>

<ul>
{% for p in proyectos %}
    <li style="color: {{ p.color }}"
        data-proyecto-id="{{ p.id }}"
        data-inicio="{{ p.inicio }}"
        data-fin="{{ p.fin }}">

        <strong>{{ p.nombre }}</strong>
        ({{ p.inicio }} â†’ {{ p.fin }})

        <!-- EDITAR / ELIMINAR PROYECTO -->
        <a href="{{ url_for('editar_proyecto', proyecto_id=p.id) }}">âœï¸ Editar</a>

        <form method="POST"
              action="{{ url_for('eliminar_proyecto', proyecto_id=p.id) }}"
              style="display:inline"
              onsubmit="return confirm('Â¿Eliminar este proyecto y todas sus tareas?');">
            <button type="submit">ğŸ—‘ï¸ Eliminar</button>
        </form>

        <!-- TAREAS -->
        <ul>
        {% for t in tareas %}
            {% if t.proyecto_id == p.id %}
               <li>
                    ğŸ“ {{ t.nombre }} ({{ t.inicio }} â†’ {{ t.fin }})

                    <a href="{{ url_for('editar_tarea', tarea_id=t.id) }}"
                    class="btn btn-edit">
                        âœï¸ Editar
                    </a>

                    <form method="POST"
                        action="{{ url_for('eliminar_tarea', tarea_id=t.id) }}"
                        class="inline-form">
                        <button type="submit"
                                class="btn btn-delete"
                                onclick="return confirm('Â¿Eliminar esta tarea?')">
                            ğŸ—‘ï¸ Eliminar
                        </button>
                    </form>
                </li>
            {% endif %}
        {% endfor %}
        </ul>

    </li>
{% else %}
    <li>No hay proyectos aÃºn</li>
{% endfor %}
</ul>

<!-- ================= CREAR TAREA ================= -->
<h2>ğŸ“ Nueva tarea</h2>

<form method="POST" action="/crear_tarea">
    <input type="text" name="nombre" placeholder="Nombre de la tarea" required>

    <label>Inicio</label>
    <input type="date" name="inicio" required>

    <label>Fin</label>
    <input type="date" name="fin" required>

    <label>Proyecto</label>
    <select name="proyecto_id" required>
        {% for p in proyectos %}
            <option value="{{ p.id }}">{{ p.nombre }}</option>
        {% endfor %}
    </select>

    <button type="submit">Crear tarea</button>
</form>

</body>
</html>